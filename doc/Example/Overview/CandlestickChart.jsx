import React, { useEffect, useRef } from 'react';
import IntegrateChart from '../../../src/index';

const CandlestickChart = props => {
  let theme = props.theme;
  const candlestickChartRef = useRef();

  useEffect(() => {
    let chartIns = new IntegrateChart();
    let chartOpt = {
      theme: `hwCloud-${theme}`,
      data: handleData(),
      padding: [50, 30],
    };
    chartIns.init(candlestickChartRef.current);
    chartIns.setSimpleOption('CandlestickChart', chartOpt, {});
    setTimeout(() => {
      if(!props.shouldRender){
        return
      }
      chartIns.render();
    }, 100);
  }, [props.shouldRender]);

  return <div style={{ width: '100%', height: '100%' }} ref={candlestickChartRef}></div>;
};

export default CandlestickChart;

const baseData = [
  ['2013/1/24', 2320.26, 2320.26, 2287.3, 2362.94, 197310000],
  ['2013/1/25', 2300, 2291.3, 2288.26, 2308.38, 221290000],
  ['2013/1/28', 2295.35, 2346.5, 2295.35, 2346.92, 191460000],
  ['2013/1/29', 2347.22, 2358.98, 2337.35, 2363.8, 225490000],
  ['2013/1/30', 2360.75, 2382.48, 2347.89, 2383.76, 237770000],
  ['2013/1/31', 2383.43, 2385.42, 2371.23, 2391.82, 223250000],
  ['2013/2/1', 2377.41, 2419.02, 2369.57, 2421.15, 197960000],
  ['2013/2/4', 2425.92, 2428.15, 2417.58, 2440.38, 197310000],
  ['2013/2/5', 2411, 2433.13, 2403.3, 2437.42, 186280000],
  ['2013/2/6', 2432.68, 2434.48, 2427.7, 2441.73, 260090000],
  ['2013/2/7', 2430.69, 2418.53, 2394.22, 2433.89, 254170000],
  ['2013/2/8', 2416.62, 2432.4, 2414.4, 2443.03, 224300000],
  ['2013/2/18', 2441.91, 2421.56, 2415.43, 2444.8, 214920000],
  ['2013/2/19', 2420.26, 2382.91, 2373.53, 2427.07, 219720000],
  ['2013/2/20', 2383.49, 2397.18, 2370.61, 2397.94, 234260000],
  ['2013/2/21', 2378.82, 2325.95, 2309.17, 2378.82, 186170000],
  ['2013/2/22', 2322.94, 2314.16, 2308.76, 2330.88, 206560000],
  ['2013/2/25', 2320.62, 2325.82, 2315.01, 2338.78, 247660000],
  ['2013/2/26', 2313.74, 2293.34, 2289.89, 2340.71, 273970000],
  ['2013/2/27', 2297.77, 2313.22, 2292.03, 2324.63, 208990000],
  ['2013/2/28', 2322.32, 2365.59, 2308.92, 2366.16, 224800000],
  ['2013/3/1', 2364.54, 2359.51, 2330.86, 2369.65, 183810000],
  ['2013/3/4', 2332.08, 2273.4, 2259.25, 2333.54, 227760000],
  ['2013/3/5', 2274.81, 2326.31, 2270.1, 2328.14, 187810000],
  ['2013/3/6', 2333.61, 2347.18, 2321.6, 2351.44, 182880000],
  ['2013/3/7', 2340.44, 2324.29, 2304.27, 2352.02, 160720000],
  ['2013/3/8', 2326.42, 2318.61, 2314.59, 2333.67, 160590000],
  ['2013/3/11', 2314.68, 2310.59, 2296.58, 2320.96, 277850000],
  ['2013/3/12', 2309.16, 2286.6, 2264.83, 2333.29, 197560000],
  ['2013/3/13', 2282.17, 2263.97, 2253.25, 2286.33, 208340000],
  ['2013/3/14', 2255.77, 2270.28, 2253.31, 2276.22, 169730000],
  ['2013/3/15', 2269.31, 2278.4, 2250, 2312.08, 164370000],
  ['2013/3/18', 2267.29, 2240.02, 2239.21, 2276.05, 219890000],
  ['2013/3/19', 2244.26, 2257.43, 2232.02, 2261.31, 220560000],
  ['2013/3/20', 2257.74, 2317.37, 2257.42, 2317.86, 229950000],
];

function handleData() {
  const newData = baseData.map(item => {
    const obj = {
      date: item[0],
      open: item[1],
      close: item[2],
      lowest: item[3],
      highest: item[4],
      volume: item[5],
    };
    return obj;
  });
  return newData;

}
